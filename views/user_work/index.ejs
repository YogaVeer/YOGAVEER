<% layout("layouts/boilerplate_user") %>
<div class="welcome-message">
  <h2 style="color: white; padding-top: 80px;">Welcome, <%= user.name ? user.name : user.displayName || "User" %>!</h2>
</div>

<div class="container mt-3" style="color: white;">
  <h1 class="mb-4 text-start">Working Professionals</h1>

  <div class="d-flex flex-wrap justify-content-center gap-4" style="padding-top: 100px;">
    <% courses.forEach(course => { %>
      <div class="card shadow-sm text-center" style="width: 250px; height: 250px;">
        <div class="card-body d-flex flex-column justify-content-between">
          <div>
            <h3 class="card-title" style="font-size: 1.5rem;"><%= course.name %></h3>
            <hr>
            <h5 class="card-text small text-muted" style="font-size: 1rem;"><%= course.description %></h5>
          </div>
          <a href="/user/working_professionals/<%= course._id %>" class="btn btn-sm btn-primary mt-auto" style="font-size: 1.1rem">Start Learning</a>
        </div>
      </div>
    <% }) %>
  </div>
    <div class="text-center mb-5">
  <% if (!bundlePurchased) { %>
    <button class="btn btn-primary purchase-btn" onclick="purchaseAll('working_professionals')">
      Purchase All Working Professionals Courses (5 Months Access) â€“ â‚¹1999
    </button>
  <% } else { %>
    <div class="alert alert-success congrats-box">
      Congratulations! You have access now.
    </div>
  <% } %>
</div>
</div>

<style>
  /* ðŸ”¹ Dull Background Overlay */
  body::before {
    content: "";
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background-color: rgba(31, 31, 31, 0.4); /* Adjust for dullness */
    z-index: -1;
  }

  body {
    background: url("/images/working_professional.jpg") no-repeat center center fixed;
    background-size: cover;
    position: relative;
    z-index: 0;
  }

  /* ðŸ”¹ Card with transparent white */
  .card {
    background-color: rgba(255, 255, 255, 0.664); /* Semi-transparent */
    border: none;
    transition: transform 0.3s;
  }

  .card:hover {
    transform: scale(1.03);
  }

  /* ðŸ”¹ Start Learning Button Styling */
  .btn-primary {
    background-color: rgb(1, 24, 45); /* Bootstrap default blue */
    border-color: white;
    color: white;
    transition: background-color 0.3s, border-color 0.3s;
    border-radius: 20px;
  }

  .btn-primary:hover {
    background-color: #555;
    border-color: #555;
    color: white;
  }

  .btn-primary:active,
  .btn-primary:focus,
  .btn-primary:active:focus {
    background-color: #555 !important;
    border-color: #555 !important;
    box-shadow: none !important;
    color: white !important;
  }
    /* Purchase Button ko aur classy banao */
.purchase-btn {
  padding: 12px 24px;
  font-size: 1.2rem;
  border-radius: 30px;
  font-weight: 600;
  margin-top: 20px;
}

/* Congrats message ko card style */
.congrats-box {
  display: inline-block;
  font-size: 1.1rem;
  font-weight: 500;
  color: #155724;
  background: rgba(212, 237, 218, 0.9);
  border: 1px solid #c3e6cb;
  border-radius: 10px;
  padding: 12px 20px;
  margin-top: 20px;
  box-shadow: 0px 2px 8px rgba(0,0,0,0.15);
}
</style>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
  function purchaseAll(category) {
    fetch(`/payment/create-order-all/${category}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then(res => res.json())
      .then(data => {
        var options = {
          key: "<%= razorpayKeyId %>",   // ðŸ‘ˆ isko tum server se pass kar rahe ho
          amount: data.order.amount,
          currency: "INR",
          name: "Yogaveer",
          description: "Unlock All " + category + " Courses",
          order_id: data.order.id,
          handler: function (response) {
            fetch("/payment/verify_payment_all", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                razorpay_payment_id: response.razorpay_payment_id,
                razorpay_order_id: response.razorpay_order_id,
                razorpay_signature: response.razorpay_signature,
                category: category,
                userId: "<%= user._id %>",   
                amount: data.order.amount
              })
            })
              .then(res => res.json())
              .then(result => {
                if (result.success) {
                  alert("All courses unlocked successfully!");
                  window.location.href = "/user"; // redirect after success
                } else {
                  alert("Payment verified but unlock failed. Contact support.");
                }
              });
          },
          theme: { color: "#3399cc" },
        };
        var rzp = new Razorpay(options);
        rzp.open();
      })
      .catch(err => {
        console.error("Order creation failed:", err);
        alert("Failed to start payment. Please try again.");
      });
  }
</script>




